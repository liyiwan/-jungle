<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE hibernate-mapping PUBLIC  
        "-//Hibernate/Hibernate Mapping DTD 3.0//EN"  
        "http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">  
<hibernate-mapping>  
	<sql-query name="StockWarningGoods">
		<![CDATA[
			SELECT Goods.GoodsID AS GoodsId, Goods.GoodsNO AS GoodsNo, Goods.GoodsName AS GoodsName,
			       Goods.Stock AS Stock,
			       Goods.SellCountMonth AS SellCountMonth,
			       Goods.ProviderID AS ProviderId,
			       Goods.Remark AS Remark,
			       MyGoods.PicPath AS PicPath
			FROM
				(
					SELECT a.GoodsID AS GoodsID, a.GoodsNO AS GoodsNO, a.GoodsName AS GoodsName, a.bBlockUp AS bBlockUp, a.Remark AS Remark,
					       (SELECT ISNULL(SUM(stock),0) FROM G_Stock_Spec WHERE GoodsID=a.GoodsID) AS Stock,
					       (SELECT ISNULL(SUM(SellCount),0) FROM G_sta_SellDay WHERE GoodsID = a.GoodsID AND datediff(day, staDay, getdate()) < 31) AS SellCountMonth,
					b.ProviderID AS ProviderID, c.OrderPos AS OrderPos
					FROM G_Goods_GoodsList a, G_Goods_Provider b, G_Cfg_ProviderList c
					WHERE a.GoodsID = b.GoodsID AND b.ProviderID = c.ProviderID AND a.bBlockUp = 0 AND a.FlagID <> 13 AND a.GoodsID IN (SELECT DISTINCT GoodsID FROM G_Stock_Spec WHERE Stock = 0 AND FlagID <> 13)
				) Goods LEFT JOIN J_MyGoods MyGoods ON Goods.GoodsID = MyGoods.GoodsID
			WHERE Goods.Stock < 50 AND (MyGoods.StockWarningDate IS NULL OR MyGoods.StockWarningDate < GETDATE()) ORDER BY Goods.OrderPos
		]]>
	</sql-query>
	<sql-query name="StockSpecByGoods">
		<![CDATA[
			SELECT StockSpec.GoodsID AS GoodsId,StockSpec.SpecID AS SpecId,GoodsSpec.SpecName AS SpecName,SUM(StockSpec.Stock) AS Stock
			FROM G_Stock_Spec StockSpec, G_Goods_GoodsSpec GoodsSpec
			WHERE StockSpec.GoodsID = GoodsSpec.GoodsID AND StockSpec.SpecID = GoodsSpec.SpecID AND GoodsSpec.FlagID <> 13 AND StockSpec.GoodsID = :goodsId
			Group By StockSpec.GoodsID,StockSpec.SpecID,GoodsSpec.SpecName
		]]>
	</sql-query>
</hibernate-mapping>
